###########
# Options #
###########

# Terminal config
set -g default-terminal 'xterm-kitty'
set -as terminal-overrides ',xterm-kitty:RGB'
set -g xterm-keys on
set-option -g allow-passthrough on

# Allow mouse
set -g mouse on

# Disable automatic window renaming
set -g automatic-rename off
set -g allow-rename off

# Setting base index to 1
set-option -g base-index 1
set-option -g pane-base-index 1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on

# Enabling vi keys
set -g mode-keys vi

###############
# Keybindings #
###############

# Prefix
unbind C-b
set-option -g prefix C-s
bind-key C-s send-prefix

# Home & end
bind-key -n Home send Escape "OH"
bind-key -n End send Escape "OF"

# Reload conf
unbind r
bind r source-file ~/.config/tmux/tmux.conf \; display-message -d 800 "Reloaded  "

# Split window
unbind '"'
unbind %
bind v split-window -v
bind h split-window -h

# Copy mode keys
unbind-key -T copy-mode-vi h
unbind-key -T copy-mode-vi j
unbind-key -T copy-mode-vi k
unbind-key -T copy-mode-vi l
bind-key -T copy-mode-vi j send -X cursor-left
bind-key -T copy-mode-vi k send -X cursor-down
bind-key -T copy-mode-vi l send -X cursor-up
bind-key -T copy-mode-vi m send -X cursor-right

bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toogle
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel

# Switch between windows
unbind p
unbind n
bind b previous-window
bind n next-window

###########
# Styling #
###########

# Catppuccin color palette
pink="#f5c2e7"
mauve="#cba6f7"
red="#f38ba8"
sapphire="#74c7ec"
blue="#89b4fa"
lavender="#b4befe"
text="#cdd6f4"
surface0="#313244"
base="#1e1e2e"
mantle="#181825"
crust="#11111b"

# Nerd font characters
HALF_ROUND_OPEN="#(printf '\uE0B6')"
HALF_ROUND_CLOSE="#(printf '\uE0B4')"
TRIANGLE_OPEN="#(printf '\uE0B2')"
TRIANGLE_CLOSE="#(printf '\uE0B0')"

# Status bar position
set -g status-position top

# Base status bar style
set-option -g status-style bg=${surface0},fg=${base}

# Justify window modules
set-option -g status-justify centre

# Left status bar modules
set-option -g status-left "\
#{?client_prefix,\
#[fg=${red}]#[bg=default]${HALF_ROUND_OPEN}\
#[bg=${red}]#[fg=${base}] #S \
#[fg=${red}]#[bg=default]${TRIANGLE_CLOSE},\
#[fg=${mauve}]#[bg=default]${HALF_ROUND_OPEN}\
#[bg=${mauve}]#[fg=${base}] #S \
#[fg=${mauve}]#[bg=default]${TRIANGLE_CLOSE}}"

# Right status bar modules
set-option -g status-right "\
#[fg=${lavender},bg=default]${TRIANGLE_OPEN}\
#[bg=${lavender},fg=${base}]  #{pane_current_command} \
#[fg=${mauve},bg=${lavender}]${TRIANGLE_OPEN}\
#[bg=${mauve},fg=${base}]  #(date '+%H:%M') \
#[fg=${mauve},bg=default]${HALF_ROUND_CLOSE}\
"

# Status bar sides length
set-option -g status-left-length 100
set-option -g status-right-length 100

# Window status style
set-option -g window-status-format "\
#[fg=${base},bg=default]${HALF_ROUND_OPEN}\
#[bg=${base},fg=${text}]#I\
#[bg=${base},fg=${red}]:\
#[bg=${base},fg=${text}]#W\
#[fg=${base},bg=default]${HALF_ROUND_CLOSE}\
"

# Active window status style
set-option -g window-status-current-format "\
#[fg=${mauve},bg=default]${HALF_ROUND_OPEN}\
#[bg=${mauve},fg=default]#I\
#[fg=${base}]:\
#[fg=default]#W\
#[fg=${mauve},bg=default]${HALF_ROUND_CLOSE}\
"

# Messages styling
set -g message-style "bg=${surface0},fg=${text}"

# Pane borders
set -g pane-border-style "fg=${blue}"
set -g pane-active-border-style "fg=${mauve}"

###########
# Plugins #
###########

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'omerxx/tmux-sessionx'

# Vim tmux navigator keybindings
set -g @vim_navigator_mapping_left "C-j"
set -g @vim_navigator_mapping_down "C-k"
set -g @vim_navigator_mapping_up "C-l"
set -g @vim_navigator_mapping_right "F12"
set -g @vim_navigator_mapping_prev "C-\\"

# Sessionx config
set -g @sessionx-bind "o"
set -g @sessionx-auto-accept 'off'
set -g @sessionx-window-height '50%'
set -g @sessionx-window-width '50%'
set -g @sessionx-zoxide-mode 'off'
set -g @sessionx-custom-paths-subdirectories 'false'
set -g @sessionx-filter-current 'false'
set -g @sessionx-fzf-builtin-tmux 'off'
set -g @sessionx-window-mode 'off'
set -g @sessionx-preview-location 'right'
set -g @sessionx-preview-ratio '70%'
set -g @sessionx-preview-enabled 'true'
set -g @sessionx-bind-kill-session 'ctrl-x'
set -g @sessionx-bind-configuration-path 'ctrl-c'
set -g @sessionx-bind-rename-session 'ctrl-r'
set -g @sessionx-bind-abort 'ctrl-q'
set -g @sessionx-bind-tmuxinator-list 'ctrl-t'
set -g @sessionx-bind-scroll-down 'alt-k'
set -g @sessionx-bind-scroll-up 'alt-l'
set -g @sessionx-bind-tree-mode 'ctrl-m'
set -g @sessionx-tmuxinator-mode 'on'

############
# TPM init #
############
run '~/.config/tmux/plugins/tpm/tpm'
